<apex:page standardController="Program__c" extensions="Loan_Program_Controller"  docType="html-5.0" tabStyle="Program_Set_up__tab">
    <!-- Page Header -->
    <apex:includeScript value="https://code.jquery.com/jquery-2.1.4.min.js"/>
    <apex:stylesheet value="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"/>    
    <apex:includeScript value="//code.jquery.com/ui/1.11.4/jquery-ui.js"/>
    <apex:includeScript value="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"/>
    <apex:includeScript value="{!URLFOR($Resource.AMP_LoanManagment, 'js/LMS_JSLib.js')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.AMP_LoanManagment, 'css/LMDashboard_Events.css')}"/>
    <style>
    table thead tr td {font-weight:bold; padding-bottom:10px; }
           thead tr th div {text-align:center; padding: 20px 0;}
           a {text-decoration: none !important;}
           .piped li input, .x-grid3-hd-ACTION_COLUMN, .x-grid3-col-ACTION_COLUMN {display:none !important;}
        <!--.x-grid3-col-NAME {   pointer-events: none !important;   cursor: default !important;}-->
           body .bDetailBlock.bPageBlock {margin-bottom:0px;}
           .pbBottomButtons .pbTitle,.pbHeader .pbTitle{display:none;}
           .pbButtonb,.pbButton { text-align: center; }
                table {max-width: 100%;}                
                th {text-align: left;}                
                .table {width: 100%; margin-bottom: 20px;}                
                .table > thead > tr > th,
                .table > tbody > tr > th,
                .table > tfoot > tr > th,
                .table > thead > tr > td,
                .table > tbody > tr > td,
                .table > tfoot > tr > td {
                    padding: 8px;
                    line-height: 1.428571429;
                    vertical-align: top;
                    border-top: 1px solid #ddd;
                }

                .table > thead > tr > th {
                    vertical-align: bottom;
                    border-bottom: 2px solid #ddd;
                }

                .table > caption + thead > tr:first-child > th,
                .table > colgroup + thead > tr:first-child > th,
                .table > thead:first-child > tr:first-child > th,
                .table > caption + thead > tr:first-child > td,
                .table > colgroup + thead > tr:first-child > td,
                .table > thead:first-child > tr:first-child > td {
                    border-top: 0;
                }

                .table > tbody + tbody {
                    border-top: 2px solid #ddd;
                }

                .table .table {
                    background-color: #fff;
                }

                .table-condensed > thead > tr > th,
                .table-condensed > tbody > tr > th,
                .table-condensed > tfoot > tr > th,
                .table-condensed > thead > tr > td,
                .table-condensed > tbody > tr > td,
                .table-condensed > tfoot > tr > td {
                    padding: 5px;
                }

                .table-bordered {
                    border: 1px solid #ddd;
                }

                .table-bordered > thead > tr > th,
                .table-bordered > tbody > tr > th,
                .table-bordered > tfoot > tr > th,
                .table-bordered > thead > tr > td,
                .table-bordered > tbody > tr > td,
                .table-bordered > tfoot > tr > td {
                    border: 1px solid #ddd;
                }

                .table-bordered > thead > tr > th,
                .table-bordered > thead > tr > td {
                    border-bottom-width: 2px;
                }

                .table-striped > tbody > tr:nth-child(odd) > td,
                .table-striped > tbody > tr:nth-child(odd) > th {
                    background-color: #eaeaea;
                }

                .table-hover > tbody > tr:hover > td,
                .table-hover > tbody > tr:hover > th {
                    background-color: #f5f5f5;
                }

    </style>


    <apex:sectionHeader rendered="{!AND(NOT(isRecordSaved),NOT(isNewRecord))}" title="Program Setup" subtitle="Home"/>            


    <apex:sectionHeader rendered="{!AND(NOT(isRecordSaved),isNewRecord)}" title="Program Setup" subtitle="New" />
    <apex:sectionHeader rendered="{!AND(isRecordSaved,NOT(isEditRecord))}" title="Program Setup" subtitle="Edit" />


    <apex:form >   
        <apex:pageBlock mode="maindetail" rendered="{!NOT(isNewRecord)}">
            <apex:pageBlockButtons location="bottom" >  
                <apex:commandbutton rendered="{!NOT(isNewRecord)}" action="{!newRec}" value="New Program" />  
            </apex:pageBlockButtons>
        </apex:pageBlock>    
    </apex:form>
    <apex:enhancedList type="Program__c" height="600"  customizable="true" rendered="{!NOT(isNewRecord)}"/>

    <apex:form >   
        <apex:pageBlock mode="maindetail" rendered="{!NOT(isNewRecord)}">
            <apex:pageBlockButtons location="bottom" >  
                <apex:commandbutton rendered="{!NOT(isNewRecord)}" action="{!newRec}" value="New Program" />  
            </apex:pageBlockButtons>
        </apex:pageBlock>            
        <apex:pageBlock rendered="{!isNewRecord}" mode="maindetail">
            <apex:pageMessages escape="false" rendered="{!hasErrors}"/>      
            <apex:pageBlockSection title="Program Basic Information" columns="2" >
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Program Name : " for="progName"/>
                    <apex:outputLabel id="progName">
                        <apex:outputText >{!p.Country__c }-{!partner.Name}</apex:outputText>
                    </apex:outputLabel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem rendered="{!not(isRecordSaved)}">
                    <apex:outputLabel value="Country: " rendered="{!not(isEditRecord)}" for="country"/>
                    <c:RequiredContainer id="rqCountry" fieldName="Country">
                        <apex:inputField value="{!p.Country__c }" id="country">
                            <apex:actionSupport event="onchange" reRender="progName,rqPartnerName,bankDetails,sectionHeader,rqCountry"/>
                        </apex:inputField>
                    </c:RequiredContainer>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!not(isRecordSaved)}">               
                    <apex:outputLabel value="Partner Name:  " for="partnerName" />                
                    <c:RequiredContainer id="rqPartnerName" fieldName="Partner Name">
                        <apex:selectList id="partnerName" value="{!selectedPartner}" size="1"> 
                            <apex:actionSupport event="onchange" action="{!getPartnerAccount}" rerender="progName,bankDetails,sectionHeader,rqPartnerName"/>
                            <apex:selectOptions value="{!PartnerNameOptions}" /> 
                        </apex:selectList>
                    </c:RequiredContainer>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <apex:pageBlockSection id="bankDetails" title="Bank Details">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Bank Name: " for="pBankName"/>
                    <apex:outputField value="{!partner.Bank_Name__c}" id="pBankName"/>
                </apex:pageBlockSectionItem>   
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Account Number: " for="pAccNum"/>
                    <apex:outputField value="{!partner.Bank_Account_Number__c}" id="pAccNum"/>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Bank Account Holder Name: " for="pBankHoldeName"/>
                    <apex:outputField value="{!partner.Bank_Account_Holder_Name__c}" id="pBankHoldeName"/>
                </apex:pageBlockSectionItem>             
                <apex:pageBlockSectionItem rendered="{!if(p.Country__c == 'UK', true, false) }">
                    <apex:outputLabel value="Sort Code: " for="pSortCode" />
                    <apex:outputField value="{!partner.Bank_Account_Sort_Code__c}" id="pSortCode"/>
                </apex:pageBlockSectionItem>              
                <apex:pageBlockSectionItem rendered="{!OR(if(p.Country__c == 'SG', true, false),if(p.Country__c == 'HK', true, false))}">
                    <apex:outputLabel value="Bank Branch No: " for="pBranch" />
                    <apex:outputField value="{!partner.Bank_Branch_No__c}" id="pBranch"/>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSection rendered="{!if(p.Country__c == 'PH', true, false) }"/>
                <apex:pageBlockSectionItem rendered="{!if(p.Country__c == 'UK', false, true) }">

                    <apex:outputLabel value="Bank No: " for="pBankNo"/>
                    <apex:outputField value="{!partner.Bank_No__c}" id="pBankNo"/>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem rendered="{!if(p.Country__c == 'UK', true, false) }">
                    <apex:outputLabel >&nbsp;</apex:outputLabel>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="AMP Name in Partner System: " for="origName"/>
                    <apex:inputField value="{!p.Originator_Name__c}" id="origName"/>                
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >                
                    <apex:outputLabel value="Institution Code: " for="instCode"/>
                    <apex:inputField value="{!p.Institution_Code__c}" id="instCode"/> 
                </apex:pageBlockSectionItem>    
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Revenue Share Settings" rendered="{!isStepTwo}" id="rsSection">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Channel Partner: " for="cp">
                    </apex:outputLabel>
                    <apex:inputField value="{!p.Channel_partner__c }" id="cp"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Revenue Share: " for="rs">
                    </apex:outputLabel>
                    <apex:inputField value="{!p.Revenue_share__c }" id="rs" >
                        <apex:actionSupport event="onchange"
                                         rerender="rsSection"/>
                    </apex:inputField>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem rendered="{!IF(p.Revenue_share__c == true, true, false)}"> 
                    <apex:outputLabel value="Revenue Share %: " for="rsInput">
                    </apex:outputLabel>  
                    <apex:inputField value="{!p.Revenue_Share_P__c}" id="rsInput"/>                
                </apex:pageBlockSectionItem> 
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Program Validity"    rendered="{!isStepTwo}">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Start Date: " />
                    <apex:outputPanel styleclass="hideCurrDate">
                        <apex:inputField value="{!p.Start_Date__c}" styleClass="EventDatePicker" style="width: 20%;" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="End Date: " />
                    <apex:outputPanel styleclass="hideCurrDate">
                        <apex:inputField value="{!p.End_Date__c}" styleClass="EventDatePicker" style="width: 20%;" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >            
                    <apex:outputLabel value="is Active?" for="isAct">
                        <apex:outputPanel rendered="{!disableIsActive}">
                            <span class="helpButton" id="IsActive-_help">
                                <img src="/s.gif" id="HelpImage" alt="" class="helpOrb" title="" />
                                <script type="text/javascript">sfdcPage.setHelp('IsActive', "{!disableIsActiveHelpMsg}");</script>
                            </span>
                        </apex:outputPanel>
                    </apex:outputLabel>
                    <apex:inputCheckbox value="{!p.isActive__c }"  id="isAct" disabled="{!disableIsActive}" />
                </apex:pageBlockSectionItem>         
            </apex:pageBlockSection>  

            <apex:pageBlockSection rendered="{!AND(isNewRecord,isRecordSaved)}" title="Add Existing Products">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Product Name" for="prodName"> 
                    </apex:outputLabel>
                    <apex:selectList value="{!selectedProductVal}" size="1" id="prodName" > 
                        <apex:selectOptions value="{!ProductOptions}"  /> 
                    </apex:selectList>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:commandbutton action="{!addAssociation}" value="Add" disabled="{!ProductOptions.size==0}"/>  
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Added Products" rendered="{!AND(isNewRecord,isRecordSaved)}"   columns="1" id="progListSection">
                <apex:variable value="{!0}" var="count"/>

                <apex:dataTable value="{!aso}" var="a" style="width:100%;text-align:center;" border="" cellpadding="5px" rowClasses="odd,even" styleClass="table"> 
                    <apex:column value="{!a.Product__r.Name}">
                        <apex:facet name="header">Name</apex:facet>
                    </apex:column>
                    <apex:column >
                        <apex:facet name="header">Action</apex:facet> 
                        <apex:commandButton immediate="true" value="Remove" action="{!delRow}" rerender="progList,progListSection" 
                                                 disabled="{!IF(OR(a.Opportunities__r.size > 0, a.Operations__r.size > 0), true, false)}">
                            <apex:param name="contIdParam" value="{!count}" assignTo="{!countIdChosen}"/>
                        </apex:commandButton>
                        <apex:outputPanel rendered="{!IF(OR(a.Opportunities__r.size > 0, a.Operations__r.size > 0), true, false)}">
                            <span class="helpButton" id="Remove-_help">
                                <img src="/s.gif" id="HelpImage" alt="" class="helpOrb" title="" />
                                <script type="text/javascript">sfdcPage.setHelp('Remove', {!a.Operations__r.size} > 0 ? 'There is a Loan using this Product' : ({!a.Opportunities__r.size} > 0 ? 'There is an Opportunity using this Product' : ''));</script>
                            </span>
                        </apex:outputPanel>
                        <apex:variable var="count" value="{!count+ 1}"/>
                    </apex:column>
                </apex:dataTable>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="System Information">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created By: "/>
                    <apex:outputField value="{!p.CreatedByID}"/>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified By : "/>
                    <apex:outputField value="{!p.LastModifiedById}"/>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created Date: "/>
                    <apex:outputField value="{!p.CreatedDate}"/>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified Date: "/>
                    <apex:outputField value="{!p.LastModifiedDate}"/>
                </apex:pageBlockSectionItem> 
                <apex:pageBlockSectionItem />  

            </apex:pageBlockSection>
            <apex:pageBlockButtons location="both" >  
                <apex:commandbutton action="{!save}" onclick="return (isPartnerSelected())" value="Save" />
                <apex:commandbutton rendered="{!NOT(OR(NOT(isRecordSaved), AND(isRecordSaved, NOT(isDeleteActive))))}" action="{!deleteRecord}" onclick="return confirm ('Are you sure you want to delete this program?');" value="Delete" />                
                <apex:commandbutton action="{!cancel}" value="Cancel" html-formnovalidate="formnovalidate"/> 
            </apex:pageBlockButtons>
        </apex:pageBlock>    
        <apex:actionFunction name="newRecord" action="{!newRec}"/>
    </apex:form>    
    <script>

        function setFocusOnLoad() {}
        function isPartnerSelected() {
            /* var isAddPrograms =  {!isRecordSaved};
            if($("[id$=partList]").val() == 'null'&& ! isAddPrograms){
                alert('Please select a Partner. Thanks');
                return false;
            }
            return true;*/
        }
    
        function populateHeader() {
            if('{!isNewRecord}'=='true')
                $('.pageDescription').text("{!p.Country__c }-{!partner.Name}");
        }
        $(document).ready(function(){
            //populateHeader();
            
        });
    
        $(".EventDatePicker").datepicker({
            showOn: "both",
            buttonImage: "https://storage.googleapis.com/material-icons/external-assets/v2/icons/svg/ic_today_black_24px.svg",
            buttonImageOnly: true,
            buttonText: "Select date",
            dateFormat: "dd/mm/yy",
            changeMonth: true,
            changeYear: true,
            showOtherMonths: true,
            selectOtherMonths: true,
            minDate: 0,                    
            firstDay: 1 
        }); 
    </script>
</apex:page>